name: "ğŸŒ™ Nightly"

on:
  schedule:
    - cron: "0 4 * * *"
  workflow_dispatch:

jobs:
  test-race:
    name: "ğŸ§ª Race Tests"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ§° Setup"
        uses: jdx/mise-action@v2
      - name: "ğŸ§ª Race Tests"
        run: task test:race

  integration:
    name: "ğŸ”Œ Integration Tests"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ§° Setup"
        uses: jdx/mise-action@v2
      - name: "ğŸ³ Start S3 Services"
        run: task s3:up
      - name: "ğŸ§ª S3 Integration Tests"
        run: task s3:test
      - name: "ğŸ“Š S3 Benchmarks"
        run: task bench
      - name: "ğŸ³ Stop S3 Services"
        if: always()
        run: task s3:down
